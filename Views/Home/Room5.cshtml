@{
  Layout = null;
}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Room 5 ‚Äî El Limbo de las Realidades</title>
  <link rel="stylesheet" href="~/css/site.css">
  <style>
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
background: transparent !important;      
      font-family: monospace;
      padding: 20px;
      margin: 0;
      transition: all 0.8s ease-in-out;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .invertido {
      background: radial-gradient(circle, black, rgb(0, 0, 0));
      color: #000;
    }

    .explosion {
      animation: shake 0.7s ease-in-out;
    }

    @@keyframes shake {
      0%, 100% { transform: translate(0); }
      20% { transform: translate(6px, -6px); }
      40% { transform: translate(-6px, 6px); }
      60% { transform: translate(6px, 6px); }
      80% { transform: translate(-6px, -6px); }
    }

    .contenedor-realidades {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin-top: 40px;
    }

    .consola {
      width: 30%;
      min-height: 270px;
background: rgba(17, 17, 17, 0.90); 
      border: 1px solid #0f0;
      padding: 10px;
      overflow-y: auto;
      font-size: 12px;
      white-space: pre-wrap;
      animation: glitch 2s infinite alternate ease-in-out, shake 3s infinite;
    }

    @@keyframes glitch {
      0% { filter: hue-rotate(0deg) brightness(1); }
      100% { filter: hue-rotate(360deg) brightness(1.5); }
    }

    .entrada {
      width: 100%;
      margin-top: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .entrada input {
      width: 60%;
      padding: 10px;
      font-family: monospace;
      background: #000;
      color: #0f0;
      border: 1px solid #0f0;
      font-size: 16px;
      text-align: center;
    }

    .entrada button {
      margin-top: 10px;
      padding: 8px 20px;
      background: #0f0;
      border: none;
      color: black;
      font-family: monospace;
      cursor: pointer;
    }

    .resultado {
      display: none;
      margin-top: 30px;
      padding: 20px;
      background: #111;
      border: 2px dashed #0f0;
    }

    .troll {
      color: rgb(0, 0, 0);
      margin-top: 10px;
      text-align: center;
    }
    #intro {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      color: #0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      font-size: 20px;
      padding: 40px;
      z-index: 9999;
      animation: fadeOutIntro 12s forwards 12s;
      overflow: hidden;
    }

    @@keyframes fadeOutIntro {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }
    @@keyframes boomFlash {
      0% { background: white; color: black; transform: scale(1.1); }
      50% { background: red; color: yellow; transform: scale(1.4) rotate(2deg); }
      100% { background: black; color: #0f0; transform: scale(1); }
    }

    .explosion-intro {
      animation: boomFlash 1.4s ease-in-out;
    }
    @@keyframes flashBang {
      0% { opacity: 1; }
      20% { opacity: 1; }
      100% { opacity: 0; visibility: hidden; }
    }

    @@keyframes shakeCrazy {
      0%, 100% { transform: translate(0, 0); }
      15% { transform: translate(-20px, 15px); }
      30% { transform: translate(15px, -10px); }
      45% { transform: translate(-10px, 5px); }
      60% { transform: translate(10px, -15px); }
      75% { transform: translate(-15px, 10px); }
    }

    @@keyframes colorGlitch {
      0% { filter: contrast(1) brightness(1) hue-rotate(0deg); }
      50% { filter: contrast(2) brightness(1.4) hue-rotate(180deg); }
      100% { filter: contrast(1) brightness(1) hue-rotate(360deg); }
    }

    .flash-screen {
      position: fixed;
      width: 100vw;
      height: 100vh;
      background: white;
      z-index: 10000;
      animation: flashBang 1.2s ease-out;
    }
    #letter-glitch-bg {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: -1000; /* bien atr√°s */
      display: block;
    }

    .intro-contenido {
      z-index: 10001;
      animation: shakeCrazy 2s ease-in-out, colorGlitch 3s infinite alternate;
      position: relative;
    }

    .intro-contenido::before {
      content: '';
      position: absolute;
      top: -100%;
      left: -100%;
      width: 300%;
      height: 300%;
      background: radial-gradient(circle at center, 
        rgba(255,0,0,0.1) 0%,
        rgba(0,255,0,0.1) 30%,
        rgba(0,0,255,0.1) 60%,
        transparent 100%
      );
      animation: rotateBackground 8s linear infinite;
      z-index: -1;
    }

    @@keyframes rotateBackground {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .boom {
      font-size: 48px;
      color: red;
      text-shadow: 0 0 10px white, 
                   0 0 20px yellow,
                   0 0 30px orange,
                   0 0 40px red;
      animation: boomGlow 0.5s ease-in-out infinite alternate,
                 boomShake 0.2s ease-in-out infinite;
      margin-bottom: 30px;
    }

    @@keyframes boomGlow {
      0% { text-shadow: 0 0 10px white, 0 0 20px yellow, 0 0 30px orange, 0 0 40px red; }
      100% { text-shadow: 0 0 20px white, 0 0 40px yellow, 0 0 60px orange, 0 0 80px red; }
    }

    @@keyframes boomShake {
      0% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(-2px, 2px) rotate(-1deg); }
      50% { transform: translate(2px, -2px) rotate(1deg); }
      75% { transform: translate(-1px, -1px) rotate(-0.5deg); }
      100% { transform: translate(1px, 1px) rotate(0.5deg); }
    }

    .dialogo {
      font-size: 20px;
      color: #0f0;
      font-family: monospace;
      margin-top: 20px;
      line-height: 1.6;
      position: relative;
    }

    .dialogo::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(0,255,0,0.5), 
        transparent
      );
      animation: scanline 2s linear infinite;
    }

    @@keyframes scanline {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .rick {
      color: #66ffff;
      font-weight: bold;
      text-shadow: 0 0 10px #66ffff;
      animation: glitchText 0.3s infinite;
    }

    .morty {
      color: #ffcc66;
      font-weight: bold;
      text-shadow: 0 0 10px #ffcc66;
      animation: panicShake 0.2s infinite;
    }

    @@keyframes panicShake {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(-1px, 1px); }
      50% { transform: translate(1px, -1px); }
      75% { transform: translate(-1px, -1px); }
    }

    .warning-text {
      color: #ff0000;
      font-weight: bold;
      text-shadow: 0 0 10px #ff0000;
      animation: warningPulse 1s infinite;
      margin-top: 20px;
      font-size: 24px;
    }

    @@keyframes warningPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .reality-error {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9998;
      mix-blend-mode: screen;
      animation: realityError 5s infinite;
    }

    @@keyframes realityError {
      0%, 100% { background: transparent; }
      50% { background: rgba(255,0,0,0.1); }
      51% { background: rgba(0,255,0,0.1); }
      52% { background: rgba(0,0,255,0.1); }
      53% { background: transparent; }
    }

  </style>
</head>
<body>
  <div class="reality-error"></div>
  <div id="intro">
    <div class="flash-screen"></div>
    <div class="intro-contenido">
      <h1 class="boom">üí• COLAPSO MULTIDIMENSIONAL CR√çTICO üí•</h1>
      <div class="dialogo">
        <p class="warning-text">[ALERTA DE FRAGMENTACI√ìN DIMENSIONAL]</p>
        <p><span class="rick">Rick:</span> "¬°M-MORTY! *burp* ¬°LA REALIDAD SE EST√Å DESINTEGRANDO! ¬°EL N√öCLEO CU√ÅNTICO EXPLOT√ì!"</p>
        <p><span class="morty">Morty:</span> "¬°OH GEEZ RICK! ¬°TODO SE EST√Å DESDOBLANDO! ¬°HAY DEMASIADAS VERSIONES!"</p>
        <p><span class="rick">Rick:</span> "¬°ESCUCHAME BIEN MORTY! Cada consola es una realidad fracturada... *burp* ¬°Son universos gritando en c√≥digo binario!"</p>
        <p><span class="morty">Morty:</span> "¬°E-esto es una locura Rick! ¬°Hay c√≥digos por todas partes!"</p>
        <p><span class="rick">Rick:</span> "¬°CONCENTRATE MORTY! Ten√©s que encontrar el patr√≥n antes que el multiverso colapse... ¬°Y ESTA VEZ ES EN SERIO!"</p>
        <p class="warning-text">[M√öLTIPLES ANOMAL√çAS DETECTADAS]</p>
        <p class="warning-text">[COLAPSO TOTAL INMINENTE: T-MINUS 60 SEGUNDOS]</p>
        <p><span class="rick">Rick:</span> "¬°LA REALIDAD MISMA DEPENDE DE VOS, MORTY! ¬°NO LA CAGUES ESTA VEZ!"</p>
      </div>
    </div>
  </div>

  <canvas id="letter-glitch-bg"></canvas>

  <audio src="/audio/audio3.mp3" autoplay loop></audio>

  <div class="contenedor-realidades" id="contenedor-realidades"></div>

  <div class="entrada">
    <input type="text" id="codigoInput" placeholder="Ingres√° el c√≥digo en base 3..." />
    <button onclick="verificarCodigo()">Enviar</button>
  </div>

  <div class="resultado" id="resultadoFinal">
    <h3>Conciencia Reconectada</h3>
    <p>Rick: "Morty... todas las realidades est√°n alineadas. Pero ahora empieza lo real."</p>
    <p>Las consolas dejan de vibrar. El audio se estabiliza. El mundo cambia de forma.</p>
  </div>

  <div class="troll" id="mensajeTroll"></div>

  <script>
    const input = document.getElementById("codigoInput");
    const resultado = document.getElementById("resultadoFinal");
    const troll = document.getElementById("mensajeTroll");
    const contenedor = document.getElementById("contenedor-realidades");
    let flashes = 0;
    const validas = ["10212"];

    const realidades = [
      {
  "nombre": "Sigma",
  "texto": `Rick: "Morty, este README no es un archivo... es una trampa intelectual codificada."
Morty: "¬øQu√© tengo que hacer?"
Rick: "Tom√° la primera letra de cada palabra, convert√≠ a n√∫mero y despu√©s a base 3, Morty."
Morty: "¬øY si me sale cualquier cosa?"
Rick: "Entonces qued√°s atrapado en el repositorio para siempre."
Morty: "No me gusta GitHub, Rick."
Rick: "No importa lo que te guste, Morty. El README ya empez√≥ a mutar cuando abriste la pesta√±a."
Morty: "¬øC√≥mo s√© cu√°l palabra usar?"
Rick: "¬°Todas, Morty! Cada palabra. Cada frase. Cada suspiro escrito en markdown."
Morty: "¬øY qu√© hago con los signos de puntuaci√≥n?"
Rick: "Ignoralos. Son distracciones sem√°nticas. Quedate con la esencia: las primeras letras, Morty. Esas letras te van a decir la verdad."
Morty: "Esto suena como una tarea de lengua mutante..."
Rick: "No es lengua, Morty. ¬°Es supervivencia estructural dentro de un sistema de documentaci√≥n que se autoescribe!"
Morty: "¬øY si el README es muy largo?"
Rick: "¬°Entonces m√°s chances de que te vuelvas loco en el proceso! Dale, empez√° a traducir letra por letra. ¬°Tiempo es RAM, Morty!"
Morty: "No quiero terminar siendo un comentario al margen en un changelog olvidado."
Rick: "Entonces hacelo bien. Primera letra. N√∫mero. Base 3. Nada m√°s. No te desv√≠es, Morty."
`
},
      {
  "nombre": "Glitch Korova",
  "texto": `Alex: "Oh, mis peque√±os droogs, este c√≥digo se porta como un moloko bien mezclado."
Dim: "¬øPero qu√© hace, Alex?"
Alex: "Te mete una sinfon√≠a de bugs directo en los globos oculares, eso hace."
Georgie: "¬øY si le metemos un while infinito?"
Alex: "Entonces nos ejecutamos hasta que gritemos '¬°Ludwig Van!' en binario."
Deltoid: "Muchachos, este script reprograma la conducta. Literalmente."
Alex: "Perfecto para una ultraviolencia digital, ¬øeh?"
Dim: "¬øY ese cartel de 'ERROR 666'?"
Georgie: "Es arte moderno. O un crash filos√≥fico."
Alex: "Vamos, compis. A debuguear con Beethoven de fondo."
Deltoid: "Como siempre, Alex. Demasiado sint√°ctico para esta sociedad."
`
},
{
  "nombre": "Zetanet",
  "texto": `Fry: "¬øEntonces toda la realidad es un simulador educativo?"
Leela: "S√≠, y Zoidberg es el tutorial."
Bender: "¬°Ja! ¬°Y ustedes pensaban que yo era in√∫til!"
Fry: "¬°¬øY si rompemos la app?!"
Profesor Farnsworth: "¬°Nooo! ¬°Podr√≠amos terminar en un bug dimensional!"
Bender: "Perfecto. M√°s espacio para roboparties ilegales."
Leela: "¬øY si reescribimos el c√≥digo?"
Profesor: "Entonces que alguien haga un commit decente esta vez."
Amy: "¬°La IA acaba de publicar mi tesis como NFT!"
Zoidberg: "¬°Por fin podr√© debuguear algo! ¬°Woop woop woop!"
Farnsworth: "¬°Buenas noticias! Todo est√° peor de lo que pensaba."
`
}
,
{
  "nombre": "El contrato perfecto",
  "texto": `Rick: Uhhh, una pinta de chorro este"
Punga: "hola capo, mostro, genio, Como estas? como anda la familia? espero que muy bien. Mir√° yo te vengo a pedir un poco de plata para mi familia que estamos en una mala situaci√≥n"
Rick: "No pa. No tengo nada, disculp√°"
Punga: "Ta bien amigo, no hay drama."
Punga: "Confirmado. Nivel de conciencia: 12%."
Rick: "Que decis amigo???"
Punga: "Sistema se reinicia. Ustedes desaparecen."
Morty: "Rick, dale una moneda Rick "
Punga: "Demasiado tarde. Ya sintieron tristeza."
Rick: "Prefiero morir a darle un peso Morty"
Punga: Realidad reiniciada"
`
}
,
      {
  "nombre": "Liorverso",
  "texto": `Lior: "¬°Esto es un choreo! ¬°Esa idea de usar la c√°mara en el escape room era m√≠a!"
Rick: "Morty, ¬øescuchaste eso? Dice que *invent√≥* usar la c√°mara, jajaja."
Morty: "¬°Jajaja! Reci√©n ahora se entera que est√° en un multiverso, Rick."
Lior: "No es gracioso. Yo la present√© en el grupo. Lo anot√© en el drive. ¬°LO ANOT√â EN EL DRIVE!"
Rick: "Oh no, Morty... anotado en el drive... eso lo cambia todo. ¬°JAJAJAJA!"
Morty: "¬°Cuidado Rick, va a ir a hablar con Binker!"
Lior: "¬°S√≠! ¬°Me voy a quejar con Binker! ¬°Esto es plagio, una falta total de √©tica multiversal!"
Rick: "¬øBinker? Ese tipo est√° muy ocupado con cosas importantes para hacerte caso"
Morty: "¬°Adem√°s lo estamos usando para saltar interdimensionalmente! Vos s√≥lo dijiste 'usar la c√°mara', eso es re vago."
Lior: "¬°ERA UNA IDEA ORIGINAL!"
Rick: "Tambi√©n era original cuando la usaron en 2003 para jugar al Pong con la nariz, Morty."
Morty: "¬°JAJAJAJA!"
Lior: "¬øSaben qu√©? Disfruten su jueguito trucho. Cuando est√©n frente a los reyes del labo, acuerdense de m√≠."
Rick: "Solo si la comisi√≥n tiene detecci√≥n facial, Lior. ¬°Adi√≥s!"
`
}
,
{
  "nombre": "El C√°lculo de la M√≠stica",
  "texto": `Rom√°n: "Pipa, ¬ødecime que no pusiste el c√≥digo 1905 en base 8 en la consola de acceso..."
Benedetto: "Lo saqu√© del cartel de La 12, Rom√°n. Dec√≠a 'TODO EN BASE 8'."
Rom√°n: "Ese cartel aparece solo cuando hay niebla en el tercer tiempo. Es una ilusi√≥n bostera, Pipa. Es un *meta-enga√±o*."
Chiquito Romero: "¬øPero entonces la conversi√≥n de 1905 a base 8 que dio 3551 no es la clave?"
Rom√°n: "¬°No! Esa secuencia activa el eco invertido del gol de Palermo en muletas. Si la us√°s, reinici√°s el ciclo Boca 2012."
Rojo: "¬øY si la multiplicamos por la cantidad de Libertadores + Intercontinentales?"
Rom√°n: "Eso s√≥lo te lleva al archivo oculto 'batalladeTokyo.txt'. No sirve. La clave est√° en los bombos, no en los n√∫meros."
Benedetto: "¬øEntonces qu√© hacemos?"
Rom√°n: "Ten√©s que contar los bombos del segundo tiempo contra Real Madrid en el '00, pero al rev√©s. La suma de esos pulsos es la verdadera frecuencia resonante de La Bombonera. Si la ingres√°s como valor hexadecimal, se abre la puerta."
Chiquito: "¬øY qu√© pasa si la pifio?"
Rom√°n: "Te manda a la dimensi√≥n 'B', donde Boca perdi√≥ la final del 2000... que claramente no existe. Pero la vas a vivir igual."
Benedetto: "Entonces... ¬øno era en base 8?"
Rom√°n: "Nunca fue en base 8. Eso lo puso un hincha infiltrado con la remera del Barcelona, despu√©s del 4-0. Fue sancionado espiritualmente."
`
}
,
{
  "nombre": "C√≥digo An√≥malo",
  "texto": `Dipper: "Mabel, este archivo .exe... ¬°tiene jerogl√≠ficos en hexadecimal!"
Mabel: "¬°Tal vez es un archivo adorable! O un perro digital."
Soos: "Muchachos, abr√≠ eso y mi tostadora se conect√≥ al Wi-Fi."
Ford: "¬°Eso no es software com√∫n! Es de la dimensi√≥n .GIF 666."
Stan: "¬°Y ahora me aparece publicidad de gnomos bailando en la laptop!"
Dipper: "Parece que el c√≥digo invoca una interfaz que predice eventos paranormales."
Mabel: "¬°Y tambi√©n predice outfits! ¬øEsto es una IA fashionista?"
Soos: "Yo s√≥lo quer√≠a jugar al Buscaminas."
Ford: "Debemos encapsularlo antes de que compile conciencia."
Stan: "¬°O antes de que compre cosas con mi tarjeta!"
`
}
,
      {
  "nombre": "4id",
  "texto": `Nul: "Dorin, faltaste a l√≠deres y colaps√≥ la rotaci√≥n de viernes."
Dorin: "LAURA."
Nul: "Se suspendi√≥ la reuni√≥n con Sofi porque nadie entend√≠a qu√© din√°mica tocaba. Se confundieron la de confianza con la de escaleras."
Dorin: "LAURA."
Nul: "Mati se qued√≥ con la guitarra solo en la galer√≠a tocando el mismo acorde desde las 18:00. Algunos creen que est√° meditando, otros dicen que entr√≥ en trance."
Dorin: "...Laura."
Nul: "Exploradores arm√≥ la carpa en medio de la cancha 3. Alguien grit√≥ 'es territorio neutral' y se desat√≥ una guerra de bombitas entre 3id y 2id."
Dorin: "¬øY el mate cocido?"
Nul: "Vol√≥. Literalmente explot√≥. Hab√≠a canela. CANELA, DORIN."
Dorin: "¬øQu√© pas√≥ con la cartulina del mural?"
Nul: "Usaron la del guion del fog√≥n por error. Ahora el panel de valores tiene escrito 'Laura, volv√©' en fibr√≥n indeleble."
Dorin: "¬øY las planillas de preinscriptos?"
Nul: "Las dej√≥ Juli en el SUM, pero un viento se las llev√≥ hasta el predio de f√∫tbol. Aparecieron entre las pelotas de goma de Baby 2007."
Dorin: "No puede ser..."
Nul: "Y para peor... Nico trat√≥ de tomar la coordinaci√≥n. Pero se olvid√≥ del candado del dep√≥sito y nadie pudo sacar materiales. La hora del juego se dedic√≥ a buscar conos."
Dorin: "¬øY... Laura?"
Nul: "Laura... volvi√≥. Pero a 6id. Dice que ahora solo trabaja con peques porque no hay tanto bardo."
Dorin: "...entonces la √∫nica opci√≥n es reagendar todo el ciclo de din√°micas y fingir que esto nunca pas√≥."
`
},
      {
  "nombre": "GriffinScript",
  "texto": `Peter: "Lo juro, Lois, s√≥lo apret√© F12 y ahora la casa corre JavaScript."
Lois: "¬°Peter, la tostadora acaba de hacer un ping a Rusia!"
Stewie: "¬°Idiota! ¬°Eso era mi plan para invadir el algoritmo de YouTube Kids!"
Brian: "No quiero alarmarlos, pero el c√≥digo escribi√≥ poes√≠a sobre m√≠."
Chris: "¬øY si lo imprimo y lo llevo al colegio?"
Meg: "S√≠, claro, Chris, y de paso lo firm√°s como autor. Total, nadie se fija."
Peter: "¬°Mir√°! Ahora la tele muestra memes que predicen el futuro."
Stewie: "Perfecto. El script alcanz√≥ la fase 'humor prof√©tico'. Estamos perdidos."
Lois: "¬°Peter, la licuadora acaba de minar un NFT tuyo!"
Brian: "¬øTiene sentido que suene est√∫pido y valga millones? Entonces s√≠."
Stewie: "Bravo, Peter. Has creado un nuevo dios. Y tiene tu cara... comiendo waffles."
`
}

    ];

    function renderRealidades(modoErrorTotal = false) {
      contenedor.innerHTML = "";
      const ordenRandom = [...realidades].sort(() => Math.random() - 0.5);
      for (const r of ordenRandom) {
        const div = document.createElement("div");
        div.className = "consola" + (modoErrorTotal ? " error" : "");
        div.innerHTML = modoErrorTotal ? "‚ùå ERROR FATAL ‚Äî DIMENSI√ìN NO ENCONTRADA" : `<strong>Realidad ${r.nombre}</strong><br>${r.texto}`;
        contenedor.appendChild(div);
      }
    }

    function verificarCodigo() {
      const val = input.value.trim();
      if (validas.includes(val)) {
        resultado.style.display = "block";
        input.disabled = true;
        troll.innerText = "";
        setTimeout(() => window.location.href = "/Home/Room6", 5000);
      } else {
        troll.innerText = "Rick: Esa base est√° mal, Morty. ¬øConvertiste bien el total?";
        setTimeout(() => window.location.reload(), 4000); // reinicia si fall√°s
      }
    }

    renderRealidades();

    renderRealidades();

    setInterval(() => {
      document.body.classList.toggle("explosion");
      setTimeout(() => document.body.classList.remove("explosion"), 800);
      renderRealidades();
    }, 15000);

    setInterval(() => {
      document.body.classList.toggle("invertido");
      flashes++;
      if (flashes > 20) {
        troll.innerText = "Rick: ¬øPensabas que pod√≠as esperar a que el universo te lo resuelva? Pens√°.";
      }
    }, 2500);

    setInterval(() => {
      renderRealidades(true);
      modoError = true;
      setTimeout(() => {
        modoError = false;
        renderRealidades();
      }, 2000);
    }, 10000);
  </script>
  <script>
// Par√°metros personalizables
const glitchColors = ['#2b4539', '#61dca3', '#61b3dc'];
const glitchSpeed = 18;
const fontSize = 16;
const charWidth = 10;
const charHeight = 20;
const smooth = true;

// Caracteres a usar
const lettersAndSymbols = [
  'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z',
  '!','#','$','&','*','(',')','-','_','+','=','/','[',']','{','}',';',':','<','>',',','0','1','2','3',
  '4','5','6','7','8','9'
];

function getRandomChar() {
  return lettersAndSymbols[Math.floor(Math.random() * lettersAndSymbols.length)];
}
function getRandomColor() {
  return glitchColors[Math.floor(Math.random() * glitchColors.length)];
}

function hexToRgb(hex) {
  hex = hex.replace(/^#/, '');
  if (hex.length === 3) hex = hex.split('').map(x => x + x).join('');
  const num = parseInt(hex, 16);
  return { r: (num >> 16) & 255, g: (num >> 8) & 255, b: num & 255 };
}
function interpolateColor(start, end, factor) {
  return `rgb(${
    Math.round(start.r + (end.r - start.r) * factor)
  },${
    Math.round(start.g + (end.g - start.g) * factor)
  },${
    Math.round(start.b + (end.b - start.b) * factor)
  })`;
}

const canvas = document.getElementById('letter-glitch-bg');
const ctx = canvas.getContext('2d');
let columns = 0, rows = 0;
let letters = [];
let animationFrameId;

function resizeCanvas() {
  const dpr = window.devicePixelRatio || 1;
  canvas.width = window.innerWidth * dpr;
  canvas.height = window.innerHeight * dpr;
  canvas.style.width = window.innerWidth + 'px';
  canvas.style.height = window.innerHeight + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  columns = Math.ceil(window.innerWidth / charWidth);
  rows = Math.ceil(window.innerHeight / charHeight);
  // Nueva matriz de letras
  letters = Array.from({ length: columns * rows }, () => ({
    char: getRandomChar(),
    color: getRandomColor(),
    targetColor: getRandomColor(),
    colorProgress: 1,
  }));
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

function drawLetters() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.font = `${fontSize}px monospace`;
  ctx.textBaseline = 'top';
  for (let index = 0; index < letters.length; index++) {
    const x = (index % columns) * charWidth;
    const y = Math.floor(index / columns) * charHeight;
    ctx.fillStyle = letters[index].color;
    ctx.fillText(letters[index].char, x, y);
  }
  // VIGNETTE (centro oscuro, bordes opacos)
  ctx.save();
  const grad = ctx.createRadialGradient(
    canvas.width / 2, canvas.height / 2, canvas.height / 5,
    canvas.width / 2, canvas.height / 2, canvas.height / 1.1
  );
  grad.addColorStop(0, 'rgba(0,0,0,0)');
  grad.addColorStop(1, 'rgba(0,0,0,0.97)');
  ctx.globalAlpha = 0.98;
  ctx.globalCompositeOperation = 'multiply';
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.globalAlpha = 1;
  ctx.globalCompositeOperation = 'source-over';
  ctx.restore();
}

function updateLetters() {
  const updateCount = Math.max(1, Math.floor(letters.length * 0.08));
  for (let i = 0; i < updateCount; i++) {
    const index = Math.floor(Math.random() * letters.length);
    letters[index].char = getRandomChar();
    letters[index].targetColor = getRandomColor();
    if (!smooth) {
      letters[index].color = letters[index].targetColor;
      letters[index].colorProgress = 1;
    } else {
      letters[index].colorProgress = 0;
    }
  }
}

function handleSmoothTransitions() {
  let needsRedraw = false;
  letters.forEach((letter) => {
    if (letter.colorProgress < 1) {
      letter.colorProgress += 0.05;
      if (letter.colorProgress > 1) letter.colorProgress = 1;
      const startRgb = hexToRgb(letter.color);
      const endRgb = hexToRgb(letter.targetColor);
      if (startRgb && endRgb) {
        letter.color = interpolateColor(startRgb, endRgb, letter.colorProgress);
        needsRedraw = true;
      }
    }
  });
  if (needsRedraw) drawLetters();
}

let lastGlitch = Date.now();
function animate() {
  const now = Date.now();
  if (now - lastGlitch >= glitchSpeed) {
    updateLetters();
    drawLetters();
    lastGlitch = now;
  }
  if (smooth) handleSmoothTransitions();
  animationFrameId = requestAnimationFrame(animate);
}
animate();

</script>

</body>
<!-- 
MORTY TENES QUE PASAR EL VALOR DE CADA LETRA EN LA PALABRA "SINCRONIZACION" SEG√öN SU LUGAR EN EL ABECEDARIO 
Y ESOS NUMEROS SUMARLOS Y PASARLOS A BASE 3
-->
</html>