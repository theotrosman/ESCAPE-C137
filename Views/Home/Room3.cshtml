@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Room 3 ‚Äî Paradoja Extendida</title>
<link rel="stylesheet" href="~/css/site.css" />
<style>
html, body {
    height: 100%;
    margin: 0;
    overflow-y: auto;
    background-color: black;
    color: #00ff00;
    font-family: monospace;
    padding: 20px;
    animation: shake 0.3s infinite alternate, flash 1s infinite alternate;
}

@@keyframes shake {
  0% { transform: translate(0px, 0px); }
  25% { transform: translate(-1px, 1px); }
  50% { transform: translate(1px, -1px); }
  75% { transform: translate(-1px, -1px); }
  100% { transform: translate(1px, 1px); }
}

@@keyframes flash {
  from { background-color: #000; }
  to { background-color: #111; }
}

.terminal {
  white-space: pre-wrap;
  font-size: 16px;
  line-height: 1.5;
  margin-bottom: 20px;
}

.code-zone, .drop-zone {
  margin-top: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.block {
  background: #002200;
  border: 1px solid #00ff00;
  padding: 10px;
  cursor: move;
  user-select: none;
  color: #00ff00;
}

.slot {
  border: 1px dashed #00ff00;
  min-height: 40px;
  padding: 10px;
  color: #00ff00;
  background: rgba(0, 50, 0, 0.3);
}

.timer {
  font-size: 20px;
  color: red;
  margin-top: 10px;
}

#universos {
  display: none;
  flex-wrap: wrap;
  margin-top: 40px;
  gap: 4px;
}

.universo {
  background: white;
  color: black;
  font-size: 10px;
  width: calc(100% / 9 - 6px);
  height: 80px;
  overflow: hidden;
  padding: 4px;
  border: 1px solid black;
}
</style>
</head>
<body>
<audio id="bgMusic" autoplay loop></audio>
<script>
const bgMusic = document.getElementById("bgMusic");
const parts = [
  "/img/rick-theme.mp3#t=0,20",
  "/img/rick-theme.mp3#t=20,40",
  "/img/rick-theme.mp3#t=40,60",
  "/img/rick-theme.mp3#t=60,80",
  "/img/rick-theme.mp3#t=80,100"
];
function playRandomPart() {
  const part = parts[Math.floor(Math.random() * parts.length)];
  bgMusic.src = part;
  bgMusic.play();
}
bgMusic.onended = playRandomPart;
playRandomPart();
</script>
<div class="terminal" id="terminal"></div>
<div class="timer" id="timer"></div>
<ul>
  <li>üìå using System; debe ir primero.</li>
  <li>üìå Despu√©s la clase <strong>Portal</strong>.</li>
  <li>üìå Luego el m√©todo <strong>Salir</strong>.</li>
  <li>üìå Luego la validaci√≥n y acci√≥n si es verdadera.</li>
  <li>üìå Despu√©s el m√©todo <strong>Validar</strong>.</li>
  <li>üìå Finalmente el m√©todo <strong>Abrir</strong> y la llave final.</li>
</ul>
<div class="code-zone" id="codeZone"></div>
<div class="drop-zone" id="dropZone"></div>
<div id="universos"></div>
<script>
const terminal = document.getElementById("terminal");
const codeZone = document.getElementById("codeZone");
const dropZone = document.getElementById("dropZone");
const timer = document.getElementById("timer");
const universos = document.getElementById("universos");

const bloques = [
  "using System;",
  "public class Portal {",
  "    public void Salir() {",
  "        if (Validar()) { Abrir(); }",
  "    }",
  "    private bool Validar() => true;",
  "    private void Abrir() => Console.WriteLine(\"Abierto\");",
  "}"
];

const ordenCorrecto = [...bloques];
let tiempo = 105;

function iniciar() {
    
  terminal.innerText = "Rick: Morty, reconstru√≠ este mini c√≥digo o se fragmenta la realidad. Y no te equivoques... ya empieza a temblar todo.";
  timer.innerText = `‚è± Tiempo: ${tiempo}s`;
  bloques.sort(() => Math.random() - 0.5).forEach((linea, i) => {
    const b = document.createElement("div");
    b.className = "block";
    b.textContent = linea;
    b.draggable = true;
    b.id = `bloque${i}`;
    b.ondragstart = e => e.dataTransfer.setData("text", b.id);
    codeZone.appendChild(b);
  });

  for (let i = 0; i < bloques.length; i++) {
    const zona = document.createElement("div");
    zona.className = "slot";
    zona.ondragover = e => e.preventDefault();
    zona.ondrop = e => {
      const id = e.dataTransfer.getData("text");
      const bloque = document.getElementById(id);
      zona.innerText = bloque.textContent;
      bloque.remove();
      validar();
    };
    zona.onclick = () => {
      if (zona.innerText) {
        const devolver = document.createElement("div");
        devolver.className = "block";
        devolver.textContent = zona.innerText;
        devolver.draggable = true;
        devolver.ondragstart = e => e.dataTransfer.setData("text", devolver.id = Math.random());
        codeZone.appendChild(devolver);
        zona.innerText = "";
      }
    };
    dropZone.appendChild(zona);
  }
  countdown();
}

function countdown() {
  const t = setInterval(() => {
    tiempo--;
    timer.innerText = `‚è± Tiempo: ${tiempo}s`;
    if (tiempo <= 0) {
      clearInterval(t);
      fallo();
    }
  }, 1000);
}

function validar() {
  const actuales = Array.from(document.querySelectorAll(".slot")).map(z => z.innerText);
  if (actuales.every(Boolean) && actuales.join() === ordenCorrecto.join()) {
    terminal.innerText = "‚úÖ ¬°C√≥digo restaurado! Saltando a la siguiente dimensi√≥n...";
    setTimeout(() => window.location.href = "/Home/Room4", 3000);
  }
}

function fallo() {
  codeZone.innerHTML = "";
  dropZone.innerHTML = "";
  document.body.style.background = "white";
  document.body.style.color = "black";
  timer.style.display = "none";
  terminal.innerText = "üí• El c√≥digo fall√≥. Multiverso en colapso...";
  universos.style.display = "flex";
  for (let i = 0; i < 81; i++) {
    const div = document.createElement("div");
    div.className = "universo";
    const serie = series[Math.floor(Math.random() * series.length)];
    div.innerHTML = `<strong>${i}</strong><br>${serie}<br><em>Rick:</em> ${rickFrase(serie)}<br><em>Morty:</em> ${mortyFrase(serie)}`;
    universos.appendChild(div);
  }
  setTimeout(() => location.reload(), 20000);
}

const series = ["Breaking Bad", "The Office", "Evangelion", "Pokemon", "BoJack", "Gravity Falls", "Dragon Ball", "Star Wars", "Los Simpsons", "Futurama", "South Park", "Stranger Things"];
function rickFrase(s) { return `Morty, en ${s} todo est√° m√°s roto que en nuestra realidad.`; }
function mortyFrase(s) { return `¬øEn serio Rick? ¬øOtra vez ${s}?`; }

iniciar();
</script>
</body>
</html>